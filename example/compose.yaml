# This file is generated by Castor. Do not edit it manually.
volumes:
    postgres_data: {  }
services:
    postgres:
        image: 'postgres:16'
        environment:
            POSTGRES_USER: app
            POSTGRES_PASSWORD: app
        volumes:
            - 'postgres_data:/var/lib/postgresql/data'
        healthcheck:
            test:
                - CMD-SHELL
                - 'pg_isready -U app'
            interval: 5s
            timeout: 5s
            retries: 5
    app1:
        build:
            context: /home/joelwurtz/Workspace/OpenSource/castor-docker/src/Service/../Resources/php
            target: frontend
            cache_from:
                - 'type=registry,ref=${REGISTRY:-}/app1:cache'
            args:
                PHP_VERSION: '8.5'
        user: '1000:1000'
        volumes:
            - '/home/joelwurtz/Workspace/OpenSource/castor-docker/example/app1:/var/www:cached'
            - '.home:/home/app:cached'
        profiles:
            - default
        labels:
            - traefik.enable=true
            - 'traefik.http.routers.app1-frontend.rule=Host(`app1.project.test`) || Host(`project.test`) || Host(`localhost`)'
            - traefik.http.routers.app1-frontend.tls=true
            - 'traefik.http.routers.app1-frontend-unsecure.rule=Host(`app1.project.test`) || Host(`project.test`) || Host(`localhost`)'
        depends_on:
            postgres:
                condition: service_healthy
        environment:
            - 'DATABASE_URL=postgresql://app:app@postgres:5432/app?serverVersion=16&charset=utf8'
    app1-builder:
        build:
            context: /home/joelwurtz/Workspace/OpenSource/castor-docker/src/Service/../Resources/php
            target: builder
            cache_from:
                - 'type=registry,ref=${REGISTRY:-}/app1-builder:cache'
            args:
                PHP_VERSION: '8.5'
        user: '1000:1000'
        init: true
        volumes:
            - '/home/joelwurtz/Workspace/OpenSource/castor-docker/example/app1:/var/www:cached'
            - '.home:/home/app:cached'
        profiles:
            - builder
        depends_on:
            postgres:
                condition: service_healthy
        environment:
            - 'DATABASE_URL=postgresql://app:app@postgres:5432/app?serverVersion=16&charset=utf8'
    app2:
        build:
            context: /home/joelwurtz/Workspace/OpenSource/castor-docker/src/Service/../Resources/php
            target: frontend
            cache_from:
                - 'type=registry,ref=${REGISTRY:-}/app2:cache'
            args:
                PHP_VERSION: '8.2'
        user: '1000:1000'
        volumes:
            - '/home/joelwurtz/Workspace/OpenSource/castor-docker/example/app2:/var/www:cached'
            - '.home:/home/app:cached'
        profiles:
            - default
        labels:
            - traefik.enable=true
            - traefik.http.routers.app2-frontend.rule=Host(`app2.project.test`)
            - traefik.http.routers.app2-frontend.tls=true
            - traefik.http.routers.app2-frontend-unsecure.rule=Host(`app2.project.test`)
            - traefik.http.routers.app2-frontend-unsecure.middlewares=redirect-to-https@file
        depends_on:
            postgres:
                condition: service_healthy
        environment:
            - 'DATABASE_URL=postgresql://app:app@postgres:5432/app?serverVersion=16&charset=utf8'
    app2-builder:
        build:
            context: /home/joelwurtz/Workspace/OpenSource/castor-docker/src/Service/../Resources/php
            target: builder
            cache_from:
                - 'type=registry,ref=${REGISTRY:-}/app2-builder:cache'
            args:
                PHP_VERSION: '8.2'
        user: '1000:1000'
        init: true
        volumes:
            - '/home/joelwurtz/Workspace/OpenSource/castor-docker/example/app2:/var/www:cached'
            - '.home:/home/app:cached'
        profiles:
            - builder
        depends_on:
            postgres:
                condition: service_healthy
        environment:
            - 'DATABASE_URL=postgresql://app:app@postgres:5432/app?serverVersion=16&charset=utf8'
    router:
        build: /home/joelwurtz/Workspace/OpenSource/castor-docker/src/Service/../Resources/router
        volumes:
            - '/var/run/docker.sock:/var/run/docker.sock'
            - '.home:/home/app:cached'
        ports:
            - '80:80'
            - '443:443'
            - '8080:8080'
        networks:
            - default
        profiles:
            - default
include:
    - compose.override.yaml
